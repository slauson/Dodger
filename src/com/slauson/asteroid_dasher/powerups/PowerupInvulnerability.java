package com.slauson.asteroid_dasher.powerups;

import java.util.ArrayList;
import java.util.List;

import com.slauson.asteroid_dasher.objects.Asteroid;
import com.slauson.asteroid_dasher.status.Achievements;
import com.slauson.asteroid_dasher.status.Upgrades;

/**
 * Invulnerability powerup that makes ship invulnerable for short time period
 * @author josh
 *
 */
public class PowerupInvulnerability extends InactivePowerup {

	// constants
	private static final int DURATION_0 = 10000;
	private static final int DURATION_1 = 15000;
	private static final int DURATION_2 = 20000;
	private static final int DURATION_3 = 30000;

	private int counter;
	
	/** List of asteroid ids passed through (for achievement) **/
	private List<Integer> asteroidsPassedThrough;
	
	public PowerupInvulnerability(int level) {
		super(level);
		
		counter = Integer.MAX_VALUE;
		asteroidsPassedThrough = new ArrayList<Integer>();
	}
	
	public void update() {
		counter--;
		
		if (counter < 0) {
			counter = Integer.MAX_VALUE;
		}
	}
	
	public int getCounter() {
		return counter;
	}
	
	@Override
	public void activate() {
		
		if (!isActive()) {
			asteroidsPassedThrough.clear();
		}
		
		switch(level) {
		case Upgrades.INVULNERABILITY_UPGRADE_INCREASED_DURATION_1:
			activate(DURATION_1);
			break;
		case Upgrades.INVULNERABILITY_UPGRADE_INCREASED_DURATION_2:
			activate(DURATION_2);
			break;
		case Upgrades.INVULNERABILITY_UPGRADE_INCREASED_DURATION_3:
		case Upgrades.INVULNERABILITY_UPGRADE_DASHER:
			activate(DURATION_3);
			break;
		default:
			activate(DURATION_0);
			break;
		}
	}
	
	/**
	 * Returns true if player can destroy powerups with dash while invulnerable
	 * @return true if player can destroy powerups with dash while invulnerable
	 */
	public boolean isDasher() {
		return level >= Upgrades.INVULNERABILITY_UPGRADE_DASHER;
	}
	
	/**
	 * Increments the number of passed through asteroids
	 * @param asteroid asteroid passed through
	 */
	public void passThrough(Asteroid asteroid) {
		if (!asteroidsPassedThrough.contains(asteroid.getID())) {
			asteroidsPassedThrough.add(asteroid.getID());
		}
	}

	/**
	 * Checks invulnerability powerup related achievements
	 */
	public void checkAchievements() {
		if (asteroidsPassedThrough.size() >= Achievements.LOCAL_INVULNERABILITY_PASS_THROUGH_NUM) {
			Achievements.unlockLocalAchievement(Achievements.localInvulnerabilityPassThrough);
		}
	}

}